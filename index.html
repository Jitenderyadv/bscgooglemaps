<!DOCTYPE html>
<html lang="en">

<head>
    <title>Static Google Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>

    <div class="container">
        <form class="form-horizontal">
            <fieldset>

                <!-- Form Name -->
                <legend>Configure Map Parameters</legend>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="apiKey">API Key</label>
                    <div class="col-md-4">
                        <input id="apiKey" name="apiKey" type="text" placeholder="API Key (optional)" class="form-control input-md">

                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="mapCentre">Map Centre</label>
                    <div class="col-md-4">
                        <input id="mapCentre" name="mapCentre" type="text" placeholder="Map Centre" class="form-control input-md" required="">

                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="mapWidth">Width</label>
                    <div class="col-md-2">
                        <input id="mapWidth" name="mapWidth" type="text" placeholder="Width" class="form-control input-md" required="">

                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="mapHeight">Height</label>
                    <div class="col-md-2">
                        <input id="mapHeight" name="mapHeight" type="text" placeholder="Height" class="form-control input-md" required="">

                    </div>
                </div>

    </div>


    </fieldset>
    </form>

    </div>

    <script src="/blocksdk.js"></script>

    <script>
        let sdk = new window.sfdc.BlockSDK(); //initalize SDK

        let mapData = {
            apiKey: '',
            mapCentre: 'London, UK',
            mapHeight: 300,
            mapWidth: 600
        };

        let defualtContent = '<img width="600" src="https://maps.googleapis.com/maps/api/staticmap?center=London,+UK&zoom=12&scale=1&size=600x300&maptype=roadmap&format=png&visual_refresh=true" alt="Google Map of Albany, NY">';

        let saveData = () => {
            console.log('Saving data...');


            // document.getElementById('apiKey').value = mapData.apiKey;
            // document.getElementById('mapWidth').value = mapData.mapWidth;
            // document.getElementById('mapHeight').value = mapData.mapHeight;
            // document.getElementById('mapCentre').value = mapData.mapCentre;

            sdk.setData(mapData, (data) => {
                // data = dataObject;
            });

            console.log(JSON.stringify(mapData));

        }

        let fetchData = () => {

            console.log('Loading data...');

            // mapData.apiKey = document.getElementById('apiKey').value;
            // mapData.mapWidth = document.getElementById('mapWidth').value;
            // mapData.mapHeight = document.getElementById('mapHeight').value;
            // mapData.mapCentre = document.getElementById('mapCentre').value;


            sdk.getData((data) => {
                if (Object.keys(data).length > 0) {
                    mapData = data;
                    document.getElementById('apiKey').value = mapData.apiKey;
                    document.getElementById('mapWidth').value = mapData.mapWidth;
                    document.getElementById('mapHeight').value = mapData.mapHeight;
                    document.getElementById('mapCentre').value = mapData.mapCentre;
                    console.log('Found data!');
                }
            });

            console.log(JSON.stringify(mapData));
        }


        // sdk.setSuperContent(defualtContent, (newSuperContent) => {
        //     defualtContent = newSuperContent;
        // });



        // <!-- 
        //         sdk.getContent((content) => {
        //             content += '.';
        //             console.log('-- Content: ' + content);

        //             sdk.setContent(content, (setContent) => {
        //                 // block content is now its original content + '.'
        //             });
        //         }); -->

        sdk.setContent('<img width="600" src="https://maps.googleapis.com/maps/api/staticmap?center=' + mapData.mapCentre + '&zoom=12&scale=1&size=' + mapData.mapWidth + 'x' + mapData.mapHeight + '&maptype=roadmap&format=png&visual_refresh=true" alt="Google Map of Albany, NY">');

        window.onload = fetchData;
        window.onunload = saveData;
    </script>

</body>

</html>